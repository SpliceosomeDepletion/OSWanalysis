cd ~/mysonas/PRPF8/data/DDAsearch

IDs='20180125034955881-1368832 20180125071256764-1368866 20180125091455947-1368889
20180125172128554-1368968 20180125200328599-1368996 20180125224730134-1369040
20180126013828710-1369062 20180126045228631-1369103 20180126070528777-1369133
20180126093828713-1369158 20180126122029482-1369199 20180126160428736-1369244
20180126183628754-1369259 20180126212828881-1369283 20180126235028771-1369297
20180127031228755-1369316 20180127055428838-1369338 20180127080629574-1369353
20180127111128865-1369379 20180127141429630-1369406 20180127170828862-1369429
20180127192128908-1369452 20180127222528900-1369488 20180129172830462-1369750
20180129200329317-1369792 20180129222730047-1369884 20180130010529363-1369926
20180130044129621-1369991 20180130064829399-1370025 20180130092331580-1370057
20180130120831597-1370160 20180130150529851-1370205 20180130183129829-1370250
20180130204529863-1370273 20180130234030552-1370301 20180131025429921-1370332
20180131050829899-1370367 20180131081230216-1370401 20180131110629987-1370559
20180131140129984-1370594 20180131163430005-1370618 20180131191930774-1370693
20180131215231478-1370752 20180201063330107-1370886 20180201090637457-1370925
20180201122337658-1370976 20180201150736960-1371014 20180202195936356-1371328
20180203021537529-1371390 20180203051936406-1371431 20180203073337181-1371458
20180203100737523-1371490 20180203132036433-1371518 20180203211038254-1371597
20180203235636531-1371631 20180204024137653-1371662 20180204051437005-1371687
20180204081136576-1371729 20180204105636944-1371763 20180204132937467-1371789
20180204162536699-1371818 20180204192249366-1371858 20180204213750192-1371880
20180205003150198-1371910 20180205030549598-1371936 20180205062249422-1371976
20180205090549444-1371998 20180205114849719-1372022 20180205141049760-1372040
20180205173349620-1372073 20180205201549640-1372091 20180205224849686-1372125
20180125010655991-1368806 20180201005630048-1370787 20180201035230072-1370832'

for id in ${IDs}
do
  file=`ls ~/mysonas/html/openBIS/${id}/heuselm*.mzXML.gz`
  cp ${file} .
done

gunzip *.mzXML.gz

for id in ${IDs}
do
  file=`ls ~/mysonas/html/openBIS/${id}/heuselm*.mzXML.gz`
  name=${file##*/}
  bsub -R "rusage[mem=20000,scratch=20000]" -J "comet" comet -PHeLa_protgen_combined_1FPKM_reverse_comet.params -N${name%.*}_FPKM1 ${file}
done

bsub -R "rusage[mem=200000,scratch=200000]" -J "xinteract_1FPKM" -w "done(comet)" xinteract -dreverse_ -OARPd -Ninteract_1FPKM heuselm*_FPKM1.pep.xml
bsub -R "rusage[mem=200000,scratch=200000]" -J "iprophet_1FPKM" -w "done(xinteract_1FPKM)" InterProphetParser DECOY=reverse_ *interact_1FPKM.pep.xml iprophet_1FPKM.pep.xml

# peptide prophet
# 0.0100	0.8147	775297

# spectrast
bsub -R "rusage[mem=200000,scratch=200000]" -J spectrast_irt spectrast -cNSpecLib -cf "Protein! ~ reverse_" -cP0.8147 -c_IRTirtkit.txt -c_IRR iprophet_1FPKM.pep.xml
bsub -R "rusage[mem=40000,scratch=40000]" -w "done(spectrast_irt)" -J spectrast_cons spectrast -cNSpecLib_cons_all -cAC SpecLib.splib

bsub -R "rusage[mem=40000,scratch=40000]" -J spectrast2tsv -w "done(spectrast_cons)" spectrast2tsv.py -l 350,2000 -s b,y -x 1,2 -o 6 -n 6 -p 0.05 -d -e -w swath64_noheader.txt -k openswath -a SpecLib_cons_openswath.tsv SpecLib_cons_all.sptxt

bsub -R "rusage[mem=40000,scratch=40000]" -w "done(spectrast2tsv)" -J toTraML TargetedFileConverter -in SpecLib_cons_openswath.tsv -out SpecLib_cons_openswath.TraML

bsub -n 8 -R "rusage[mem=4096,scratch=8192]" -W 24:00 -J "DecoyGenerator" -w "done(toTraML)" OpenSwathDecoyGenerator -in SpecLib_cons_openswath.TraML -out SpecLib_cons_openswath_decoys.TraML -threads 8

bsub -n 8 -R "rusage[mem=4096,scratch=8192]" -W 24:00 -J "conversion_to_pqp" -w "done(DecoyGenerator)" TargetedFileConverter -in SpecLib_cons_openswath_decoys.TraML -out SpecLib_cons_openswath_decoys.pqp -threads 8
