# Generate a standard library using the standard workflows
cd ~/mysonas/PRPF8/data/DIAsearch

IDs='20171222084719949-1361573 20171222124319906-1361608 20171222134820739-1361628
20171222151320614-1361644 20171222152419905-1361645 20171222180120603-1361676
20171222204919935-1361714 20171222230920622-1361743 20171223014320075-1361760
20171223042119991-1361796 20171223061420025-1361814 20171223071620023-1361829
20171223092320074-1361846 20171223114420049-1361860 20171223140920055-1361890
20171223154120078-1361910 20171223175320117-1361924 20171223202520147-1361946
20171223234920846-1361979 20171224005120142-1361988 20171224040720134-1362011
20171224052920158-1362020 20171224093020190-1362055 20171224110220186-1362066
20171224135820222-1362088 20171224154620968-1362108 20171224183320287-1362127
20171224203920299-1362142 20171224225520296-1362166 20171225002023248-1362177
20171225035921212-1362209 20171225054120368-1362219 20171225085420365-1362248
20171225102920374-1362256 20171225131621668-1362276 20171225135920439-1362284
20171225163020462-1362309 20171225181220533-1362328 20171225211521232-1362399
20171225223720506-1362404 20171226014021247-1362430 20171226035620557-1362444
20171226060120561-1362454 20171226080520579-1362472 20171226100720627-1362486
20171226122820675-1362496 20171226150523259-1362534 20171226170720655-1362547
20171226192302182-1362567 20171226221620787-1362580 20171227003820747-1362588
20171228013820907-1362724 20171228043220988-1362748 20171228060421609-1362760
20171228080820942-1362780 20171228102120981-1362792 20171228133521020-1362995
20171228145825115-1363003 20171228173221025-1363027 20171228192621140-1363037
20171228220821085-1363058 20171229000121070-1363071 20171229020221793-1363085
20171229044521117-1363103 20171229064822079-1363113 20171229085021117-1363123
20171229110225143-1363137 20171229133421168-1363151 20171229155621155-1363163
20171229173821179-1363171 20171229203021246-1363188 20171229225224573-1363201
20171230005421326-1363211 20171230031621381-1363226 20171230054021369-1363239
20171230080221352-1363251 20171230100522176-1363265 20171230121721351-1363275
20171230143921362-1363289 20171230171121423-1363303 20171230193421412-1363315
20171230214621448-1363327 20171230233821444-1363341 20171231030124840-1363357
20171231050321469-1363371 20171231073621499-1363381 20171231092821510-1363393
20171231122121555-1363407 20171231150421571-1363421 20171231174722344-1363439
20171231192022498-1363447 20180102041421878-1363567 20180102070721884-1363579
20180102075921922-1363589 20180102105222746-1363602 20180102141621952-1363621
20180102160921962-1363629 20180102185225993-1363640 20180102201422000-1363646
20180103000722250-1363661 20180103014022022-1363670 20180103040322034-1363674
20180103044522053-1363679 20180103084822622-1363693 20180103102122639-1363702
20180103131422725-1363712 20180103134622663-1363717 20180103170922675-1363733
20180103183122741-1363741 20180103220722735-1363762 20180104021522718-1363795
20180104055324831-1363821 20180104063625602-1363826 20180104091325813-1363843
20180104104927018-1363859 20180104133422862-1363955 20180104150022851-1363967
20180104172422862-1363984 20180104191725729-1364004 20180104224722866-1364044
20180104233822901-1364054 20180105022624101-1364091 20180105033923033-1364104
20180105065423502-1364129 20180105083823527-1364149 20180105105423173-1364191
20180111020425468-1365540 20180111021524654-1365547 20180111022626073-1365552
20180111030026608-1365567 20180111031324818-1365574 20180111031327069-1365576
20180111032424669-1365583 20180111033424622-1365585 20180111033527527-1365589
20180111034725615-1365597 20180111035824679-1365599 20180111035924692-1365600
20180111040925495-1365604 20180111042024644-1365610 20180111042125389-1365614
20180111045324606-1365623 20180111045325321-1365624 20180114013102141-1366164
20180114034402201-1366181 20180114052702185-1366192 20180114075002373-1366203
20180114101403184-1366219 20180114122702252-1366227 20180114144003277-1366239
20180114165302298-1366251 20180114193602968-1366261 20180114215903053-1366276
20180114234202413-1366286 20180115021502377-1366299 20180115043803166-1366318
20180115071202458-1366341'

# repeat jobs that ran into wall time
#IDs='20171223154120078-1361910 20180111045325321-1365624 20180111031324818-1365574'

Temp_SWATH_DIR=/cluster/scratch/ibludau/PRPF8
SWATH_results_DIR=~/mysonas/PRPF8/data/DIAsearch/output
Library=../DDAsearch/transitionlist_optimized_decoys.pqp
iRT_Library=~/mysonas/libraries/hroest_DIA_iRT_201311.TraML

for id in ${IDs}
do
  file=`ls ~/mysonas/html/openBIS/${id}/*.mzXML.gz`
  name=`echo ${file} | xargs -n 1 basename`
  Temp_DIR_filewise=${Temp_SWATH_DIR}/${name%.*.*}/
  mkdir -p ${Temp_DIR_filewise}
  bsub -J OpenSwathWorkflow -n 8 -R "rusage[mem=16384,scratch=16384]" -W 24:00 \
  OpenSwathWorkflow -min_upper_edge_dist 1 \
  -tr_irt ${iRT_Library} -tr ${Library} \
  -threads 8 -readOptions cache \
  -tempDirectory ${Temp_DIR_filewise} \
  -in ${file} -out_osw ${SWATH_results_DIR}/${name%.*.*}.osw \
  -out_chrom ${SWATH_results_DIR}/${name%.*.*}.chrom.mzML \
  -mz_extraction_window 50 -ppm \
  -use_ms1_traces \
  -Scoring:stop_report_after_feature 5
done
